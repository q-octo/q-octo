#include <Arduino.h>
#include <cybergear.h>
#include <can.h>

static void onReceiveExtendedCANPacket(int packetSize, long packetId, uint8_t *packetData)
{
    Serial.print("main.cpp: Received packet with id 0x");
    Serial.print(packetId, HEX); 
    cybergear_receive_can_message(packetSize, packetId, packetData);
}

static void setupViaLibrary() {}

void setup()
{
    Serial.begin(115200);
    while (!Serial) delay(10);
    Serial.println("Hello, we're live!");

    // CanCommunication::init(onReceiveExtendedCANPacket);
    // for (size_t i = 0; i < 128; i++)
    // {

    //     init_cybergear(&mi_motor[0], i, Position_mode);
    //     check_cybergear(i);
    //     delay(10);
    // }
    setupViaLibrary();
}

void loop()
{

    // Wait 3 seconds
    delay(3000);
    motor_position_control(&mi_motor[0], 6);
    delay(3000);
    motor_position_control(&mi_motor[0], 0.0);
  
}
